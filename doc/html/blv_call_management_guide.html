<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>BlueViaAndroidSDK: Call Management API guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.3 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">BlueViaAndroidSDK&#160;<span id="projectnumber">1.4</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('blv_call_management_guide.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<h1>Call Management API guide </h1>  </div>
</div>
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="call_abstract_sec"></a>
Abstract</h2>
<p>The Bluevia Call Management API is a set of functions which allows users to perform phone calls between two addresses, including itself or not. This guide represents a practical introduction to developing applications in which the user wants to provide the Bluevia Call Management functionality.</p>
<h2><a class="anchor" id="blv_call_api_making_call_session_sec"></a>
Bluevia Call Management API: Making call sessions</h2>
<p>The Bluevia Call Management API is a set of functions which allows users to perform phone calls between two addresses, including itself or not. This guide represents a practical introduction to developing applications in which the user wants to provide the Bluevia Call Management functionality.</p>
<h3><a class="anchor" id="call_client_basics_sec"></a>
Call ManagementClient Basics</h3>
<p>A Call Management client represents the client side in a classic client-server schema. This object wraps up the underlying REST client side functionality needed to perform requests against a REST server. Moreover the Call Management client provides a set of mock working modes useful to test its functionality even without connectivity or a real server.</p>
<p>Any Bluevia client perform requests and receive responses in a secure mode. Clients are authorized following the OAuth protocol. This security protocol enables users to grant third-party access to their resources without sharing their passwords. So clients store the authorization data -called security credentials- to grant access the server. Following sections describe what security credentials we are talking about.</p>
<h3><a class="anchor" id="creating_a_call_client_sec"></a>
Creating a Call ManagementClient</h3>
<p>The first step in using the Call Management client is to create a CallManagementClient object. As we mentioned earlier this object could have two different working modes: i) as a client which sends requests to a real server, or ii) as a client which sends request and receives responses to/from a mock server. If the user wants to test or to run his application by using a mock client he also can decide how the server will work.</p>
<h4><a class="anchor" id="callmanagementclient_features_working_modes_sec"></a>
CallManagementClient features: working modes</h4>
<p>When you create the client, you can specify various working modes: </p>
<ul>
<li>
<p class="startli">AbstractRestClient.Mode.LIVE <br/>
In the Live environment your application uses the real network, which means that you will be able to send real transactions to real Movistar, O2 and Vivo customers in the applicable country.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">AbstractRestClient.Mode.TEST <br/>
The Test mode behave exactly like the Live mode, but the API calls are free of chargue, using a credits system. You are required to have a Movistar, O2 or Vivo mobile number to get this monthly credits.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">AbstractRestClient.Mode.SANDBOX <br/>
The Sandbox environment offers you the exact same experience as the Live environment except that no traffic is generated on the live network, meaning you can experiment and play until your heartâ€™s content.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">AbstractRestClient.Mode.MOCK_OK <br/>
The client works against a mock Bluevia server which always serves properly any request.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">AbstractRestClient.Mode.MOCK_UNAUTHORIZED <br/>
The client works against a mock Bluevia server which always responds with an BlueviaClientException informing the user is not authorized to perform that request.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">AbstractRestClient.Mode.MOCK_ERROR_IOEXCEPTION <br/>
The client works against a mock Bluevia server which always responds with an BlueviaClientException informing the user is unable to connect the server due to an in/out exception.</p>
<p class="endli"></p>
</li>
<li>
AbstractRestClient.Mode.MOCK_ERROR_HTTPEXCEPTION <br/>
The client works against a mock Bluevia server which always responds with a BlueviaClientException informing the user is unable to connect the server due a http exception. </li>
</ul>
<h4><a class="anchor" id="callmanagementclient_features_security_credentials"></a>
CallManagementClient features: security credentials</h4>
<p>BlueVia uses OAuth as its authentication mechanism which enables websites and applications to access the BlueVia API's without end users disclosing their personal credentials. In order to grant access to the server any client has to be created passing the security credential as parameter in its constructor. These security credentials are managed internally and added as a HTTP header in every request sent to the server. Such Oauth security credentials are: </p>
<ul>
<li>
<p class="startli"><b>Consumer key</b> <br/>
The string identifying the application- you obtained when you registered your application within the provisioning portal.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><b>Consumer Secret</b> <br/>
A secret -a string- used by the consumer to establish ownership of the consumer key.</p>
<p class="endli"></p>
</li>
<li>
<b>Access token</b> <br/>
The token -OAuth access token- used by the client for granting access permissions to the server </li>
</ul>
<h4><a class="anchor" id="callmanagementclient_features_call_participants_and_displayed_addresses"></a>
CallManagementClient features: call participants and displayed addresses</h4>
<p>The Call ManagementClient is able to make a call session between two addresses (call participants), which may include itself or not. These call participants are specified by the object called UserId. This class represent the user identification. It may be used to identify the user on requests.</p>
<p>The participants of the call session must be identified by: </p>
<ul>
<li>
<p class="startli">A phone number. The user must indicate a phone number as 'userIdValue' value which is a maximum of 15 digits following the E164 format and a UserId.PHONE_NUMBER value for the 'type' parameter.</p>
<div class="fragment"><pre class="fragment"> UserId userId(UserId.PHONE_NUMBER, <span class="stringliteral">&quot;0034913374214&quot;</span>);
</pre></div> </li>
</ul>
<p>Once the call participants has been specified, the user may established the address (an MSISDN or a string) which will be displayed on the handsets. The displayed addresses are also represented by UserId objects.</p>
<p>They may be identified by:</p>
<ul>
<li>
<p class="startli">A phone number. The user must indicate a phone number as 'userIdValue' value which is a maximum of 15 digits following the E164 format and a UserId.PHONE_NUMBER value for the 'type' parameter.</p>
<div class="fragment"><pre class="fragment"> UserId userId(UserId.PHONE_NUMBER, <span class="stringliteral">&quot;0034913374214&quot;</span>);
</pre></div><p class="endli"></p>
</li>
<li>
<p class="startli">An alias. The user must indicate a any alphanumeric string as 'userIdValue' value and a UserId.ALIAS value for the 'type' parameter.</p>
<div class="fragment"><pre class="fragment"> UserId userId(UserId.ALIAS, <span class="stringliteral">&quot;MyApplication&quot;</span>);
</pre></div><p class="endli"></p>
</li>
<li>
<p class="startli">Private mode. The user must indicate the "anonymous" string as 'userIdValue' value and a UserId.ALIAS value for the 'type' parameter.</p>
<div class="fragment"><pre class="fragment"> UserId userId(UserId.ALIAS, <span class="stringliteral">&quot;anonymous&quot;</span>);
</pre></div> </li>
</ul>
<p>Note: if no displayed address is set, a default value will be specified by the network</p>
<h4><a class="anchor" id="callmanagementclient_features_media_info"></a>
CallManagementClient features: media info</h4>
<p>The media info indicates one or more media types for the call session. Its available values are:</p>
<ul>
<li>
AUDIO </li>
<li>
VIDEO </li>
<li>
CHAT </li>
<li>
DATA </li>
</ul>
<p>For each media type, the direction of the communication (incoming, outgoing or bidirectional) shall be indicated. If media info is omitted, the media type(s) shall be negotiated by the underlying network.</p>
<h4><a class="anchor" id="callmanagementclient_features_freeing_resources_sec"></a>
CallManagementClient features: freeing resources</h4>
<p>It is very important to free the resources that the client instantiates to work. To do this call the close method after finishing using the client:</p>
<div class="fragment"><pre class="fragment">callManagementClient.close();
</pre></div><h4><a class="anchor" id="callmanagementclient_features_code_examples_sec"></a>
CallManagementClient features: code examples</h4>
<p>Find below an example about how to create a CallManagementClient taking into account all information previously given.</p>
<div class="fragment"><pre class="fragment"><span class="comment">// The token - OAuth access token.</span>
Token accessToken = <span class="keyword">new</span> Token(<span class="stringliteral">&quot;oauth_token&quot;</span>, <span class="stringliteral">&quot;oauth_token_secret&quot;</span>);

<span class="comment">// AbstractRestClient.Mode.LIVE indicating the client works against a real server.</span>
<span class="keywordflow">try</span> {
        BlueviaCallManagementClient callManagementClient = <span class="keyword">new</span> BlueviaCallManagementClient(getApplicationContext(), Mode.LIVE,
                <span class="stringliteral">&quot;consumer_key&quot;</span>, <span class="stringliteral">&quot;consumer_secret&quot;</span>, accessToken);
} <span class="keywordflow">catch</span> (BlueviaClientException e){
        Log.e(TAG, e.getMessage());
}
</pre></div><h3><a class="anchor" id="make_call_session_sec"></a>
Making a call session</h3>
<p>This API allows users to make a call session between two addresses. Once you have instantiated a BlueviaCallManagementClient, you can start using the makeCallSession method, which has the following signature:</p>
<div class="fragment"><pre class="fragment">String <span class="keywordtype">id</span> = makeCallSession(firstCallParticipant, secondCallparticipant, firstParticipantDisplayedAddress, 
        secondParticipantDisplayedAddress, mediaInfoList, changeMediaNotAllowed);
</pre></div><p>The first two mandatory parameters indicate the call participants, and the second two (optional) specify the displayed addresses to be shown on the handsets. Notice that the firstParticipantDisplayedAddress is the identification of the caller that will be displayed on the firstCallParticipant's handset, and the secondParticipantDisplayedAddress is the one that will be displayed on secondParticipantDisplayedAddress's one. The mediaInfoList parameters, which is optional, may contain a list of media information as seen above. Finally, the changeMediaNotAllowed specifies if the switching process across different media is not allowed.</p>
<p>A string identifier of the call session will be returned by the function.</p>
<p>For a more detailed description please see the <a class="el" href="api_reference.html">API Reference</a>.</p>
<h3><a class="anchor" id="blv_call_api_code_example"></a>
Bluevia Call Management API: code example</h3>
<div class="fragment"><pre class="fragment"><span class="comment">// Make a call session</span>
<span class="comment">// Create the client (you have to choose the mode (HTTP/Mock) and include the authorization values)</span>
Token accessToken = <span class="keyword">new</span> Token(<span class="stringliteral">&quot;oauth_token&quot;</span>, <span class="stringliteral">&quot;oauth_token_secret&quot;</span>);
   
BlueviaCallManagementClient callManagementClient = <span class="keyword">new</span> BlueviaCallManagementClient(getApplicationContext(), Mode.LIVE, <span class="stringliteral">&quot;consumer_key&quot;</span>, <span class="stringliteral">&quot;consumer_secret&quot;</span>, accessToken);

<span class="keywordflow">try</span> {
        <span class="comment">// Specify the call participants</span>
        UserId first = <span class="keyword">new</span> UserId(Type.PHONE_NUMBER,<span class="stringliteral">&quot;600112233&quot;</span>);
        UserId second = <span class="keyword">new</span> UserId(Type.PHONE_NUMBER,<span class="stringliteral">&quot;600112234&quot;</span>);

        UserId firstDisplayedAddress = <span class="keyword">new</span> UserId(Type.ALIAS,<span class="stringliteral">&quot;Jake&quot;</span>);
        UserId secondDisplayedAddress = <span class="keyword">new</span> UserId(Type.ALIAS,<span class="stringliteral">&quot;Elwood&quot;</span>);

        <span class="comment">// Make the call session</span>
        String <span class="keywordtype">id</span> = callManagementClient.makeCallSession(first, second, firstDisplayedAddress, secondDisplayedAddress, null, <span class="keyword">false</span>);
        Log.d(TAG, <span class="stringliteral">&quot;Call session created with identifier: &quot;</span> + <span class="keywordtype">id</span>);
} <span class="keywordflow">catch</span> (BlueviaClientException e) {
        Log.e (TAG,<span class="stringliteral">&quot;Error making call session&quot;</span>, e);
}


<span class="comment">// Finally close the client</span>
callManagementClient.close();
</pre></div> </div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="footer">Generated on Wed Dec 21 2011 11:13:04 for BlueViaAndroidSDK by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3 </li>
    </ul>
  </div>

</body>
</html>
