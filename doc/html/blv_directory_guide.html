<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>BlueViaAndroidSDK: Directory API guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.3 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">BlueViaAndroidSDK&#160;<span id="projectnumber">1.4</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('blv_directory_guide.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<h1>Directory API guide </h1>  </div>
</div>
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="directory_abstract_sec"></a>
Abstract</h2>
<p>The Bluevia Directory API is a set of functions which allows users to retrieve user-related information, divided in three blocks (user profile, access information and user terminal information). This guide represents a practical introduction to developing applications in which the user wants to provide the Bluevia Directory functionality.</p>
<h2><a class="anchor" id="blv_directory_api_retrievings_ads_sec"></a>
Bluevia Directory API: Accessing Directory information</h2>
<p>The Bluevia Directory API is a set of functions which allows users to retrieve user-related information, divided in three blocks (user profile, access information and user terminal information). This guide represents a practical introduction to developing applications in which the user wants to provide the Bluevia Directory functionality.</p>
<h3><a class="anchor" id="directory_client_basics_sec"></a>
Directory Client Basics</h3>
<p>A Directory client represents the client side in a classic client-server schema. This object wraps up the underlying REST client side functionality needed to perform requests against a REST server. Moreover the Directory client provides a set of mock working modes useful to test its functionality even without connectivity or a real server.</p>
<p>Any Bluevia client performs requests and receives responses in a secure mode. Clients are authorized following the OAuth protocol. This security protocol enables users to grant third-party access to their resources without sharing their passwords. So clients store the authorization data -called security credentials- to get access to the server. Following sections describe the security credentials we are talking about.</p>
<h3><a class="anchor" id="creating_directory_client_sec"></a>
Creating a Directory Client</h3>
<p>The first step in using the Directory client is to create an DirectoryClient object. As we mentioned earlier this object could have two different working modes: i) as a client which sends requests to a real server, or ii) as a client which sends request and receives responses to/from a mock server. If the user wants to test or to run his application by using a mock client he can also decide how the server will work.</p>
<h4><a class="anchor" id="directoryclient_features_working_modes_sec"></a>
DirectoryClient features: working modes</h4>
<p>When you create the client, you can specify various working modes: </p>
<ul>
<li>
<p class="startli">AbstractRestClient.Mode.LIVE <br/>
In the Live environment your application uses the real network, which means that you will be able to send real transactions to real Movistar, O2 and Vivo customers in the applicable country.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">AbstractRestClient.Mode.TEST <br/>
The Test mode behave exactly like the Live mode, but the API calls are free of chargue, using a credits system. You are required to have a Movistar, O2 or Vivo mobile number to get this monthly credits.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">AbstractRestClient.Mode.SANDBOX <br/>
The Sandbox environment offers you the exact same experience as the Live environment except that no traffic is generated on the live network, meaning you can experiment and play until your heartâ€™s content.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">AbstractRestClient.Mode.MOCK_OK <br/>
The client works against a mock Bluevia server which always serves properly any request.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">AbstractRestClient.Mode.MOCK_UNAUTHORIZED <br/>
The client works against a mock Bluevia server which always responds with an BlueviaClientException informing the user is not authorized to perform that request.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">AbstractRestClient.Mode.MOCK_ERROR_IOEXCEPTION <br/>
The client works against a mock Bluevia server which always responds with an BlueviaClientException informing the user is unable to connect the server due to an in/out exception.</p>
<p class="endli"></p>
</li>
<li>
AbstractRestClient.Mode.MOCK_ERROR_HTTPEXCEPTION <br/>
The client works against a mock Bluevia server which always responds with a BlueviaClientException informing the user is unable to connect the server due a http exception. </li>
</ul>
<h4><a class="anchor" id="directoryclient_features_security_credentials"></a>
DirectoryClient features: security credentials</h4>
<p>BlueVia uses OAuth as its authentication mechanism which enables websites and applications to access the BlueVia API's without end users disclosing their personal credentials. In order to grant access to the server any client has to be created passing the security credential as parameter in its constructor. These security credentials are managed internally and added as a HTTP header in every request sent to the server. Such Oauth security credentials are: </p>
<ul>
<li>
<p class="startli"><b>Consumer key</b> <br/>
The string identifying the application- you obtained when you registered your application within the provisioning portal.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><b>Consumer Secret</b> <br/>
A secret -a string- used by the consumer to establish ownership of the consumer key.</p>
<p class="endli"></p>
</li>
<li>
<b>Access token</b> <br/>
The token -OAuth access token- used by the client for granting access permissions to the server </li>
</ul>
<h4><a class="anchor" id="directoryclient_features_freeing_resources_sec"></a>
DirectoryClient features: freeing resources</h4>
<p>It is very important to free the resources that the client instantiates to work. To do this call the close method after finishing using the client:</p>
<div class="fragment"><pre class="fragment">directoryClient.close();
</pre></div><h4><a class="anchor" id="directoryclient_features_code_example"></a>
DirectoryClient features: code example</h4>
<p>Find below an example on how to create an DirectoryClient taking into account all information previously given.</p>
<div class="fragment"><pre class="fragment"><span class="comment">// The token - OAuth access token.</span>
Token accessToken = <span class="keyword">new</span> Token(<span class="stringliteral">&quot;oauth_token&quot;</span>, <span class="stringliteral">&quot;oauth_token_secret&quot;</span>);

<span class="comment">// AbstractRestClient.Mode.LIVE indicating the client works against a real server.</span>
<span class="keywordflow">try</span> {
        BlueviaDirectoryClient directoryClient = <span class="keyword">new</span> BlueviaDirectoryClient(getApplicationContext(), Mode.LIVE, <span class="stringliteral">&quot;consumer_key&quot;</span>, <span class="stringliteral">&quot;consumer_secret&quot;</span>, accessToken);
} <span class="keywordflow">catch</span> (BlueviaClientException e){
        Log.e(TAG, e.getMessage());
}
</pre></div><h3><a class="anchor" id="retrieving_user_info_sec"></a>
Retrieving User Info</h3>
<p>This method retrieves the whole User Info resource block from the directory. User profile includes user profile, access and terminal info blocks. The signature of the method is:</p>
<div class="fragment"><pre class="fragment">UserInfo getUserInfo() throws BlueviaClientException
</pre></div><p>Check the <a class="el" href="api_reference.html">API Reference</a> to see the information that can be obtained from the UserProfile returned object, accessible using getter methods.</p>
<h4><a class="anchor" id="retrieving_user_info_using_filters_sec"></a>
Using filters in requests</h4>
<p>In case the user doesn't want to retrieve all blocks, there is an option to retrieve only a subset of the available information, using filters. An UserInfoFilter must be instantiated, and the parameters the user wants to receive must be set to true. Then pass the filter as a parameter in the method:</p>
<div class="fragment"><pre class="fragment">UserInfo getUserInfo(UserInfoFilter filter) <span class="keywordflow">throws</span> BlueviaClientException
</pre></div><h4><a class="anchor" id="user_info_code_example_sec"></a>
Code examples</h4>
<p>This is a example for retrieving the whole user info block:</p>
<div class="fragment"><pre class="fragment"><span class="keywordflow">try</span> {
        <span class="comment">//Get the UserProfile response</span>
        UserInfo info = dc.getUserInfo();

        UserProfile profile = info.getUserProfile();
        UserAccessInfo accessInfo = info.getAccessInfo();
        UserTerminalInfo terminalInfo = info.getUserTerminalInfo();     
        
        <span class="comment">/* Get information and do stuff */</span>
          
} <span class="keywordflow">catch</span> (BlueviaClientException e) {
        Log.e (TAG,<span class="stringliteral">&quot;Error getting user profile&quot;</span>, e);
}
</pre></div><p>In this case, you have to set the parameters you want to receive to true. This is an example:</p>
<div class="fragment"><pre class="fragment"><span class="keywordflow">try</span> {
        <span class="comment">//Create the filter</span>
        UserInfoFilter sets = <span class="keyword">new</span> UserInfoFilter();
        sets.setAccessInfo(<span class="keyword">true</span>);
        sets.setProfile(<span class="keyword">true</span>);

        <span class="comment">//Get the UserProfile response</span>
        UserInfo info = directoryClient.getUserInfo(sets);
        
        <span class="comment">//Get information</span>
        UserProfile profile = info.getUserProfile();
        UserAccessInfo accessInfo = info.getUserAccessInfo();

        <span class="comment">//Do stuff.</span>

} <span class="keywordflow">catch</span> (BlueviaClientException e) {
        Log.e (TAG, <span class="stringliteral">&quot;Error getting user profile&quot;</span>, e);
}
</pre></div><p>Individual blocks can be obtained through its own method, as can be seen below:</p>
<h3><a class="anchor" id="retrieving_user_profile_sec"></a>
Retrieving User Profile</h3>
<p>This method retrieves the User Profile resource block from the directory. User profile includes payment options, subscription to services, customer type and other operator related information. The signature of the method is:</p>
<div class="fragment"><pre class="fragment">UserProfile getUserProfile() throws BlueviaClientException
</pre></div><p>Check the <a class="el" href="api_reference.html">API Reference</a> to see the information that can be obtained from the UserProfile returned object, accessible using getter methods.</p>
<h4><a class="anchor" id="retrieving_user_profile_using_filters_sec"></a>
Using filters in requests</h4>
<p>In case the user doesn't want to retrieve the whole block, there is an option to retrieve only a subset of the available information, using filters. An UserProfileFilter must be instantiated, and the parameters the user wants to receive must be set to true. Then pass the filter as a parameter in the method:</p>
<div class="fragment"><pre class="fragment">UserProfile getUserProfile(UserProfileFilter filter) <span class="keywordflow">throws</span> BlueviaClientException
</pre></div><h4><a class="anchor" id="user_profile_code_example_sec"></a>
Code examples</h4>
<p>This is a example for retrieving the whole user profile block:</p>
<div class="fragment"><pre class="fragment"><span class="keywordflow">try</span> {
        <span class="comment">//Get the UserProfile response</span>
        UserProfile up = dc.getUserProfile();

        <span class="comment">/* Get information and do stuff */</span>
          
} <span class="keywordflow">catch</span> (BlueviaClientException e) {
        Log.e (TAG,<span class="stringliteral">&quot;Error getting user profile&quot;</span>, e);
}
</pre></div><p>In this case, you have to set the parameters you want to receive to true. This is an example:</p>
<div class="fragment"><pre class="fragment"><span class="keywordflow">try</span> {
        <span class="comment">//Create the filter</span>
        UserProfileFilter filter = <span class="keyword">new</span> UserProfileFilter();
        filter.setUserType(<span class="keyword">true</span>);
        filter.setICB(<span class="keyword">true</span>);
        filter.setOCB(<span class="keyword">true</span>);
        filter.setLang(<span class="keyword">true</span>);
        filter.setOperatorId(<span class="keyword">true</span>);
        filter.setParentalControl(<span class="keyword">true</span>);
        filter.setSegment(<span class="keyword">true</span>);
        filter.setSubscribedServices(<span class="keyword">true</span>);

        <span class="comment">//Get the UserProfile response</span>
        UserProfile up = directoryClient.getUserProfile(filter);
        
        <span class="comment">//Get information</span>
        String operatorId = directoryClient.getOperatorId();

        <span class="comment">//Do stuff.</span>

} <span class="keywordflow">catch</span> (BlueviaClientException e) {
        Log.e (TAG, <span class="stringliteral">&quot;Error getting user profile&quot;</span>, e);
}
</pre></div><h3><a class="anchor" id="retrieving_user_access_info_sec"></a>
Retrieving User Access Information</h3>
<p>This method retrieves the whole User Access Information resource block from the directory. User Access Information correspond to the user connection profile and includes information like the access connection type, IP, connection time, etc. The signature of the method is:</p>
<div class="fragment"><pre class="fragment">UserAccessInfo getUserAccessInformation () throws BlueviaClientException
</pre></div><p>Check the <a class="el" href="api_reference.html">API Reference</a> to see the information that can be obtained from the UserAccessInfo returned object, accessible by getters.</p>
<h4><a class="anchor" id="user_access_info_using_filters_sec"></a>
Using filters in requests</h4>
<p>In case the user doesn't want to retrieve the whole block, there is an option only a subset of the available information, using filters. An UserAccessInfoFilter must be instantiated, and the parameters the user wants to receive must be set to true. Then pass the filter as a parameter in the method:</p>
<div class="fragment"><pre class="fragment">UserAccessInfo getUserAccessInformation (UserAccessInfoFilter filter) <span class="keywordflow">throws</span> BlueviaClientException
</pre></div><h4><a class="anchor" id="user_access_info_code_example_sec"></a>
Code examples</h4>
<p>This is a example for retrieving the whole user access information block:</p>
<div class="fragment"><pre class="fragment"><span class="keywordflow">try</span> {
        <span class="comment">//Get the UserAccessInfo responses</span>
        UserAccessInfo uai = directoryClient.getUserAccessInfo();

        <span class="comment">/* Do stuff */</span>

} <span class="keywordflow">catch</span> (BlueviaClientException e) {
        Log.e (TAG, <span class="stringliteral">&quot;Error getting user access info&quot;</span>, e);
}
</pre></div><p>In this case, you have to set the parameters you want to receive to true. This is an example:</p>
<div class="fragment"><pre class="fragment"><span class="keywordflow">try</span> {
        <span class="comment">//Create the filter</span>
        UserAccessInfoFilter filter = <span class="keyword">new</span> UserAccessInfoFilter();
        filter.setAccessType(<span class="keyword">true</span>);
                
        <span class="comment">//Get the UserAccessInfo responses</span>
        UserAccessInfo uai = directoryClient.getUserAccessInfo(filter);

        <span class="comment">//Get information</span>
        String accessTYpe = uai.getAccessType();

        <span class="comment">/* Do stuff */</span>

} <span class="keywordflow">catch</span> (BlueviaClientException e) {    
        Log.e (TAG, <span class="stringliteral">&quot;Error getting user access info&quot;</span>, e);
}
</pre></div><h3><a class="anchor" id="retrieving_user_terminal_info_sec"></a>
Retrieving User Terminal Information</h3>
<p>This method retrieves the whole User Terminal Information resource block from the directory. This block includes information about the terminal being used by the end-user. The signature of the method is:</p>
<div class="fragment"><pre class="fragment">UserTerminalInfo getUserTerminalInformation () throws BlueviaClientException
</pre></div><p>Check the <a class="el" href="api_reference.html">API Reference</a> to see the information that can be obtained from the UserTerminalInfo returned object, accessible by getter methods.</p>
<h4><a class="anchor" id="user_terminal_info_using_filters_sec"></a>
Using filters in requests</h4>
<p>In case the user doesn't want to retrieve the whole block, there is an option to retrieve only a subset of the available information, using filters. An UserTerminalInfoFilter must be instantiated, and the parameters the user wants to receive must be set to true. Then pass the filter as a parameter in the method:</p>
<div class="fragment"><pre class="fragment">UserTerminalInfo getUserTerminalInformation (UserTerminalInfoFilter filter) <span class="keywordflow">throws</span> BlueviaClientException
</pre></div><h4><a class="anchor" id="user_terminal_info_code_examples_sec"></a>
Code examples</h4>
<p>This is a example for retrieving the user terminal profile:</p>
<div class="fragment"><pre class="fragment"><span class="keywordflow">try</span> {
        <span class="comment">//Get the UserTerminalInfo response</span>
        UserTerminalInfo uti = directoryClient.getUserTerminalInfo();

        <span class="comment">/* Get relevant information and do stuff */</span>

} <span class="keywordflow">catch</span> (BlueviaClientException e) {
        Log.e (TAG, <span class="stringliteral">&quot;Error getting user terminal info&quot;</span>, e);
}
</pre></div><p>In this case, you have to set the parameters you want to receive to true. This is an example:</p>
<div class="fragment"><pre class="fragment"><span class="keywordflow">try</span> {
        <span class="comment">//Create the filter</span>
        UserTerminalInfoFilter filter = <span class="keyword">new</span> UserTerminalInfoFilter();
        filter.setBrand(<span class="keyword">true</span>);
        filter.setModel(<span class="keyword">true</span>);
        filter.setVersion(<span class="keyword">true</span>);

        <span class="comment">//Get the UserTerminalInfo response</span>
        UserTerminalInfo uti = directoryClient.getUserTerminalInfo(filter);

        String model = uti.getModel();
        String version= uti.getVersion();

        <span class="comment">/* Do stuff */</span>

} <span class="keywordflow">catch</span> (BlueviaClientException e) {
        Log.e (TAG, <span class="stringliteral">&quot;Error user terminal info&quot;</span>, e);
}
</pre></div><h3><a class="anchor" id="directory_code_example_sec"></a>
Bluevia Directory API: Code example</h3>
<div class="fragment"><pre class="fragment"><span class="comment">//-----------------------------------------------</span>
<span class="comment">// Get Some User Directory Information</span>
<span class="comment">// 1. Create the client (you have to choose the mode and include the authorization values)</span>
Token accessToken = <span class="keyword">new</span> Token(<span class="stringliteral">&quot;oauth_token&quot;</span>, <span class="stringliteral">&quot;oauth_token_secret&quot;</span>);
        
BlueviaDirectoryClient directoryClient = <span class="keyword">new</span> BlueviaDirectoryClient(getApplicationContext(), Mode.LIVE, <span class="stringliteral">&quot;consumer_key&quot;</span>, <span class="stringliteral">&quot;consumer_secret&quot;</span>, accessToken); 
        
<span class="comment">// 2. Get User Access Information</span>
String result = null;

<span class="keywordflow">try</span> {
        UserAccessInfo uai = directoryClient.getUserAccessInfo();
        
        Log.i(TAG, uai.getAccessType());

} <span class="keywordflow">catch</span> (BlueviaClientException e) {
        Log.e (TAG, <span class="stringliteral">&quot;Error getting user access info&quot;</span>, e);
}
<span class="comment">//-----------------------------------------------</span>

<span class="comment">// 3. Get User Access Information using a filter</span>
result = null;
<span class="keywordflow">try</span> {
        <span class="comment">//Create the filter</span>
        UserAccessInfoFilter filter = <span class="keyword">new</span> UserAccessInfoFilter();
        filter.setAccessType(<span class="keyword">true</span>);

        UserAccessInfo uai = directoryClient.getUserAccessInfo(filter);

        Log.i(TAG, uai.getAccessType());

} <span class="keywordflow">catch</span> (BlueviaClientException e) {
        Log.e (TAG, <span class="stringliteral">&quot;Error getting user access info&quot;</span>, e);
}
<span class="comment">//-----------------------------------------------</span>

<span class="comment">// 4. Get User Profile</span>
result = null;
<span class="keywordflow">try</span> {
UserProfile up = dc.getUserProfile();

Log.i(TAG, <span class="stringliteral">&quot;Operator Id: &quot;</span> + up.getOperatorId);

} <span class="keywordflow">catch</span> (BlueviaClientException e) {
        Log.e (TAG,<span class="stringliteral">&quot;Error testGetUserAccessInformation&quot;</span>, e);
}
<span class="comment">//-----------------------------------------------</span>

<span class="comment">// 5. Get User Profile using a filter</span>
result = null;
<span class="keywordflow">try</span> {
        <span class="comment">//Create the filter</span>
        UserProfileFilter filter = <span class="keyword">new</span> UserProfileFilter();
        filter.setUserType(<span class="keyword">true</span>);
        filter.setICB(<span class="keyword">true</span>);
        filter.setOCB(<span class="keyword">true</span>);
        filter.setLang(<span class="keyword">true</span>);
        filter.setOperatorId(<span class="keyword">true</span>);
        filter.setParentalControl(<span class="keyword">true</span>);
        filter.setSegment(<span class="keyword">true</span>);
        filter.setSubscribedServices(<span class="keyword">true</span>);

        UserProfile up = directoryClient.getUserProfile(filter);

        Log.i(TAG, <span class="stringliteral">&quot;Operator Id: &quot;</span> + up.getOperatorId);

} <span class="keywordflow">catch</span> (BlueviaClientException e) {
        Log.e (TAG, <span class="stringliteral">&quot;Error getting user profile&quot;</span>, e);
}
<span class="comment">//-----------------------------------------------</span>

<span class="comment">// 6. Get User Terminal Information</span>
result = null;
<span class="keywordflow">try</span> {
        UserTerminalInfo ut = directoryClient.getUserTerminalInfo();

        Log.i(TAG, ut.getBrand() + <span class="stringliteral">&quot; &quot;</span> ut.getModel() + <span class="stringliteral">&quot; &quot;</span> + ut.getVersion());
} <span class="keywordflow">catch</span> (BlueviaClientException e) {
        Log.e (TAG, <span class="stringliteral">&quot;Error getting user terminal info&quot;</span>, e);
}
<span class="comment">//-----------------------------------------------</span>

<span class="comment">// 7. Get User Terminal Information using a filter</span>
result = null;
<span class="keywordflow">try</span> {
        <span class="comment">//Create the filter</span>
        UserTerminalInfoFilter filter = <span class="keyword">new</span> UserTerminalInfoFilter();
        filter.setBrand(<span class="keyword">true</span>);
        filter.setModel(<span class="keyword">true</span>);
        filter.setVersion(<span class="keyword">true</span>);

        UserTerminalInfo ut = directoryClient.getUserTerminalInfo(filter);

        Log.i(TAG, ut.getBrand() + <span class="stringliteral">&quot; &quot;</span> ut.getModel() + <span class="stringliteral">&quot; &quot;</span> + ut.getVersion());

} <span class="keywordflow">catch</span> (BlueviaClientException e) {
        Log.e (TAG, <span class="stringliteral">&quot;Error user terminal info&quot;</span>, e);
}

<span class="comment">//-----------------------------------------------</span>
<span class="comment">// Finally close the client</span>
directoryClient.close();
<span class="comment">//-----------------------------------------------</span>
</pre></div> </div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="footer">Generated on Thu Jan 26 2012 11:10:32 for BlueViaAndroidSDK by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3 </li>
    </ul>
  </div>

</body>
</html>
