<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>BlueViaAndroidSDK: Location API guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.3 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">BlueViaAndroidSDK&#160;<span id="projectnumber">1.4</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('blv_location_guide.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<h1>Location API guide </h1>  </div>
</div>
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="location_abstract_sec"></a>
Abstract</h2>
<p>The Bluevia Location API is a set of functions which allows users to retrieve the geographical coordinates of a terminal where Location is expressed through a latitude, longitude, altitude and accuracy. Such operation covers the requesting for the location of a terminal.</p>
<h2><a class="anchor" id="blv_location_api_retrieving_location_information_sec"></a>
Bluevia Location API: Retrieving location information</h2>
<p>The Bluevia Location API is a set of functions which allows users to retrieve the geographical coordinates of a terminal where Location is expressed through a latitude, longitude, altitude and accuracy. Such operation covers the requesting for the location of a terminal.</p>
<h3><a class="anchor" id="location_client_basics_sec"></a>
Location Client Basics</h3>
<p>A Location client represents the client side in a classic client-server schema. This object wraps up the underlying REST client side functionality needed to perform requests against a REST server. Moreover the Location client provides a set of mock working modes useful to test its functionality even without connectivity or a real server.</p>
<p>Any Bluevia client perform requests and receives responses in a secure mode. Clients are authorized following the OAuth protocol. This security protocol enables users to grant third-party access to their resources without sharing their passwords. So clients store the authorization data -called security credentials- to grant access the server. Following sections describe what security credentials we are talking about.</p>
<h3><a class="anchor" id="creating_a_location_client_sec"></a>
Creating a Location Client</h3>
<p>The first step in using the Location client is to create an LocationClient object. As we mentioned earlier this object could have two different working modes: i) as a client which sends requests to a real server, or ii) as a client which sends request and receives responses to/from a mock server. If the user wants to test or to run his application by using a mock client he also can decide how the server will work.</p>
<h4><a class="anchor" id="locationclient_features_working_modes_sec"></a>
LocationClient features: working modes</h4>
<p>When you create the client, you can specify various working modes: </p>
<ul>
<li>
<p class="startli">AbstractRestClient.Mode.LIVE <br/>
In the Live environment your application uses the real network, which means that you will be able to send real transactions to real Movistar, O2 and Vivo customers in the applicable country.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">AbstractRestClient.Mode.TEST <br/>
The Test mode behave exactly like the Live mode, but the API calls are free of chargue, using a credits system. You are required to have a Movistar, O2 or Vivo mobile number to get this monthly credits.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">AbstractRestClient.Mode.SANDBOX <br/>
The Sandbox environment offers you the exact same experience as the Live environment except that no traffic is generated on the live network, meaning you can experiment and play until your heartâ€™s content.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">AbstractRestClient.Mode.MOCK_OK <br/>
The client works against a mock Bluevia server which always serves properly any request.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">AbstractRestClient.Mode.MOCK_UNAUTHORIZED <br/>
The client works against a mock Bluevia server which always responds with an BlueviaClientException informing the user is not authorized to perform that request.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">AbstractRestClient.Mode.MOCK_ERROR_IOEXCEPTION <br/>
The client works against a mock Bluevia server which always responds with an BlueviaClientException informing the user is unable to connect the server due to an in/out exception.</p>
<p class="endli"></p>
</li>
<li>
AbstractRestClient.Mode.MOCK_ERROR_HTTPEXCEPTION <br/>
The client works against a mock Bluevia server which always responds with a BlueviaClientException informing the user is unable to connect the server due a http exception. </li>
</ul>
<h4><a class="anchor" id="locationclient_features_security_credentials_sec"></a>
LocationClient features: security credentials</h4>
<p>BlueVia uses OAuth as its authentication mechanism which enables websites and applications to access the BlueVia API's without end users disclosing their personal credentials. In order to grant access to the server any client has to be created passing the security credential as parameter in its constructor. These security credentials are managed internally and added as a HTTP header in every request sent to the server. Such Oauth security credentials are: </p>
<ul>
<li>
<p class="startli"><b>Consumer key</b> <br/>
The string identifying the application- you obtained when you registered your application within the provisioning portal.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><b>Consumer Secret</b> <br/>
A secret -a string- used by the consumer to establish ownership of the consumer key.</p>
<p class="endli"></p>
</li>
<li>
<b>Access token</b> <br/>
The token -OAuth access token- used by the client for granting access permissions to the server </li>
</ul>
<h4><a class="anchor" id="locationclient_features_code_example"></a>
LocationClient features: code example</h4>
<p>Find below an example about how to create a LocationClient taking into account all information previously given. This snippet shows how to access a Bluevia server using OAuth security credentials</p>
<div class="fragment"><pre class="fragment"><span class="comment">// The token - OAuth access token.</span>
Token accessToken = <span class="keyword">new</span> Token(<span class="stringliteral">&quot;oauth_token&quot;</span>, <span class="stringliteral">&quot;oauth_token_secret&quot;</span>);

<span class="comment">// AbstractRestClient.Mode.LIVE indicating the client works against a real server.</span>
<span class="keywordflow">try</span> {
        BlueviaLocationClient locationClient = <span class="keyword">new</span> BlueviaLocationClient(getApplicationContext(), Mode.LIVE, <span class="stringliteral">&quot;consumer_key&quot;</span>, <span class="stringliteral">&quot;consumer_secret&quot;</span>, accessToken);
} <span class="keywordflow">catch</span> (BlueviaClientException e){
        Log.e(TAG, e.getMessage());
}
</pre></div><h3><a class="anchor" id="retrieving_the_geographical_coordinates_of_a_terminal_sec"></a>
Retrieving the geographical coordinates of a terminal</h3>
<p>The <b>getLocation</b> function allows an user to retrieve the geographical coordinates of a terminal. These geographical coordinates are expressed through a latitude, longitude, altitude and accuracy.</p>
<p>Take a look at the getLocation function signature:</p>
<div class="fragment"><pre class="fragment"><span class="keyword">public</span> LocationDataType getLocation(Integer acceptableAccuracy);
</pre></div><p>The <b>acceptableAccuracy</b> (optional) parameter expresses the range in meters that the application considers useful. If the location cannot be determined within this range, then the application would prefer not to receive the information.</p>
<p>Once the server responds the user have to retrieve the location information from the returned LocationDataType instance. The LocationDataType includes the status of the client request and the LocationInfoType member which contains the location information.</p>
<p>For a more detailed description please see the <a class="el" href="api_reference.html">API Reference</a>.</p>
<h3><a class="anchor" id="blv_location_api_code_example"></a>
Bluevia Location API: code example</h3>
<div class="fragment"><pre class="fragment"><span class="comment">// Get Location</span>
BlueviaLocationClient locationClient = null;
                
<span class="comment">// 1. Create the client (you have to choose the mode and include the OAuth authorization values)</span>
Token accessToken = <span class="keyword">new</span> Token(<span class="stringliteral">&quot;oauth_token&quot;</span>, <span class="stringliteral">&quot;oauth_token_secret&quot;</span>);
<span class="keywordflow">try</span> {
        locationClient = <span class="keyword">new</span> BlueviaLocationClient (getApplicationContext(), Mode.LIVE, 
                <span class="stringliteral">&quot;consumer_key&quot;</span>, <span class="stringliteral">&quot;consumer_secret&quot;</span>, accessToken);
} <span class="keywordflow">catch</span> (BlueviaClientException e){
        Log.e(TAG, e.getMessage());
}
        
<span class="comment">// 2. Call getLocation</span>
<span class="keywordtype">int</span> ACCEPTABLE_ACCURACY = 500;

<span class="keywordflow">try</span> {
        LocationDataType location = locationClient.getLocation(ACCEPTABLE_ACCURACY);
        <span class="comment">//do something </span>
} <span class="keywordflow">catch</span> (BlueviaClientException ex) {
        <span class="comment">//Handle the exception</span>
        Log.e (TAG, <span class="stringliteral">&quot;Error getting Location&quot;</span>, e);               
}

<span class="comment">// 3. Finally close the client</span>
locationClient.close();
}
</pre></div> </div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="footer">Generated on Thu Jan 26 2012 11:10:33 for BlueViaAndroidSDK by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3 </li>
    </ul>
  </div>

</body>
</html>
