<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>BlueViaAndroidSDK: Advertising API guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.3 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">BlueViaAndroidSDK&#160;<span id="projectnumber">1.4</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('blv_ad_guide.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<h1>Advertising API guide </h1>  </div>
</div>
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="ad_abstract_sec"></a>
Abstract</h2>
<p>The Bluevia Advertising API is a set of functions which allows users to provide advertising -based on different advertisement types such as images or texts or similar elements- within their applications. This guide represents a practical introduction to developing applications in which the user wants to provide the Bluevia Advertising functionality.</p>
<h2><a class="anchor" id="blv_ad_api_retrievings_ads_sec"></a>
Bluevia Advertising API: Retrieving advertisements</h2>
<p>The Bluevia Advertising API is a set of functions which allows users to provide advertising -based on different advertisement types such as images or texts or similar elements- within their applications. This guide represents a practical introduction to developing applications in which the user wants to provide the Bluevia Advertising functionality.</p>
<h3><a class="anchor" id="ad_client_basics_sec"></a>
AdvertisingClient Basics</h3>
<p>An Advertising client represents the client side in a classic client-server schema. This object wraps up the underlying REST client side functionality needed to perform requests against a REST server. Moreover the Advertising client provides a set of mock working modes useful to test its functionality even without connectivity or a real server.</p>
<p>Any Bluevia client performs requests and receives responses in a secure mode. Clients are authorized following the OAuth protocol. This security protocol enables users to grant third-party access to their resources without sharing their passwords. So clients store the authorization data -called security credentials- to grant access the server. The following sections describe what security credentials we are talking about.</p>
<h3><a class="anchor" id="creating_ad_client_sec"></a>
Creating an AdvertisingClient</h3>
<p>The first step in using the Advertising client is to create an BlueviaAdClient object. As we mentioned earlier this object could have two different working modes: i) as a client which sends requests to a real server, or ii) as a client which sends request and receives responses to/from a mock server. If the user wants to test or run his application by using a mock client he can also choose how the server will work.</p>
<h4><a class="anchor" id="adclient_features_working_modes_sec"></a>
AdvertisingClient features: working modes</h4>
<p>When you create the client, you can specify various working modes: </p>
<ul>
<li>
<p class="startli">AbstractRestClient.Mode.LIVE <br/>
In the Live environment your application uses the real network, which means that you will be able to send real transactions to real Movistar, O2 and Vivo customers in the applicable country.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">AbstractRestClient.Mode.TEST <br/>
The Test mode behave exactly like the Live mode, but the API calls are free of chargue, using a credits system. You are required to have a Movistar, O2 or Vivo mobile number to get this monthly credits.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">AbstractRestClient.Mode.SANDBOX <br/>
The Sandbox environment offers you the exact same experience as the Live environment except that no traffic is generated on the live network, meaning you can experiment and play until your heartâ€™s content.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">AbstractRestClient.Mode.MOCK_OK <br/>
The client works against a mock Bluevia server which always serves properly any request.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">AbstractRestClient.Mode.MOCK_UNAUTHORIZED <br/>
The client works against a mock Bluevia server which always responds with an BlueviaClientException informing the user is not authorized to perform that request.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">AbstractRestClient.Mode.MOCK_ERROR_IOEXCEPTION <br/>
The client works against a mock Bluevia server which always responds with an BlueviaClientException informing the user is unable to connect the server due to an in/out exception.</p>
<p class="endli"></p>
</li>
<li>
AbstractRestClient.Mode.MOCK_ERROR_HTTPEXCEPTION <br/>
The client works against a mock Bluevia server which always responds with a BlueviaClientException informing the user is unable to connect the server due a http exception. </li>
</ul>
<h4><a class="anchor" id="adclient_features_security_credentials"></a>
AdvertisingClient features: security credentials</h4>
<p>BlueVia uses OAuth as its authentication mechanism which enables websites and applications to access the BlueVia API's without end users disclosing their personal credentials. In order to grant access to the server any client has to be created passing the security credential as parameter in its constructor. These security credentials are managed internally and added as a HTTP header in every request sent to the server. Such Oauth security credentials are: </p>
<ul>
<li>
<p class="startli"><b>Consumer key</b> <br/>
The string identifying the application- you obtained when you registered your application within the provisioning portal.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><b>Consumer Secret</b> <br/>
A secret -a string- used by the consumer to establish ownership of the consumer key.</p>
<p class="endli"></p>
</li>
<li>
<b>Access token</b> <br/>
The token -OAuth access token- used by the client for granting access permissions to the server </li>
</ul>
<h4><a class="anchor" id="adclient_features_security_credentials_2l"></a>
AdvertisingClient features: Oauth 2-legged</h4>
<p>Some applications will only use the Advertising API, which does not need to be given permissions by the final user. Bluevia supports Oauth authentication without oauth token, which is called 2-legged version. In this case the client just need the <b>Consumer key</b> and <b>Consumer secret</b> credentials.</p>
<h4><a class="anchor" id="adclient_features_freeing_resources_sec"></a>
AdvertisingClient features: freeing resources</h4>
<p>It is very important to free the resources that the client instantiates to work. To do this call the close method after finishing using the client:</p>
<div class="fragment"><pre class="fragment">adClient.close();
</pre></div><h4><a class="anchor" id="adclient_features_code_examples_sec"></a>
AdvertisingClient features: code example</h4>
<p>Find below an example on how to create an Oauth 3-legged AdvertisingClient taking into account all the information previously given.</p>
<div class="fragment"><pre class="fragment"><span class="comment">// The token - OAuth access token.</span>
Token accessToken = <span class="keyword">new</span> Token(<span class="stringliteral">&quot;oauth_token&quot;</span>, <span class="stringliteral">&quot;oauth_token_secret&quot;</span>);

<span class="comment">// AbstractRestClient.Mode.LIVE indicating the client works against a real server.</span>
<span class="keywordflow">try</span> {
        BlueviaAdClient adClient = <span class="keyword">new</span> BlueviaAdClient(getApplicationContext(), Mode.LIVE, <span class="stringliteral">&quot;consumer_key&quot;</span>, <span class="stringliteral">&quot;consumer_secret&quot;</span>, accessToken);
} <span class="keywordflow">catch</span> (BlueviaClientException e){
        Log.e(TAG, e.getMessage());
}
</pre></div><p>And Oauth 2-legged AdvertisingClient</p>
<div class="fragment"><pre class="fragment"><span class="comment">// The token - OAuth access token.</span>

<span class="comment">// AbstractRestClient.Mode.LIVE indicating the client works against a real server.</span>
<span class="keywordflow">try</span> {
        BlueviaAdClient adClient = <span class="keyword">new</span> BlueviaAdClient(getApplicationContext(), Mode.LIVE, <span class="stringliteral">&quot;consumer_key&quot;</span>, <span class="stringliteral">&quot;consumer_secret&quot;</span>);
} <span class="keywordflow">catch</span> (BlueviaClientException e){
        Log.e(TAG, e.getMessage());
}
</pre></div><h3><a class="anchor" id="retrieving_simple_ad_sec"></a>
Retrieving a simple advertisement</h3>
<p>The Bluevia Advertising API can provide different kinds of advertisements: text, images, or both. When retrieving a simple advertisement the user could to specify a set of request parameters such as banner size, protection policy, etc.</p>
<p>Once you have instantiated a BlueviaAdClient, you can start using the simpleAd method, which has the following signature:</p>
<div class="fragment"><pre class="fragment">AdResponse simpleAd(String adSpace, String adRequestId, AdRequest.AdPresentationType adPresentation, AdPresentationSizeType adPresentationSize, String[] keywords, AdRequest.ProtectionPolicyType protectionPolicy, String country, String targetUserId) <span class="keywordflow">throws</span> BlueviaClientException
</pre></div><p>The <b>adSpace</b> parameter -that is the identifier you obtained when you registered your application within the Bluevia portal- is mandatory.<br/>
 The <b>adRequestId</b> an unique id for the request (optional: if it is not set, the SDK will generate it automatically).<br/>
 The <b>adPresentation</b> parameter is optional. It specifies what type of advertisement the user wants to retrieve.<br/>
 The <b>adPresentationSize</b> parameter allows the user to claim for a specific advertising size. This parameter is specially oriented to determine the size of the image banner when the user wants to retrieve an image. The adPresentationSize parameter is optional.<br/>
 The <b>keywords</b> parameter provides the key words the advertisement is related to. This parameter is optional too. <br/>
 The <b>protectionPolicy</b> allows an user to apply the desired the adult control policy. ProtectionPolicy is mandatory. In case you are not interested in setting a specific value for any of the optional parameters, just set it to null.<br/>
 The <b>country</b> parameter indicates the country where the target user is located. Must follow ISO-3166. (Optional: the parameter should not be included if the target user can be deduced by other means). The <b>targetUserId</b> is a string to identify the target user. (Optional: the parameter should not be included if the target user can be deduced by other means).</p>
<p>For a more detailed description please see the <a class="el" href="api_reference.html">API Reference</a>.</p>
<h4><a class="anchor" id="processing_ad_response_sec"></a>
Retrieving a simple advertisement: processing the AdResponse</h4>
<p>The AdResponse object contains, among other members, an ArrayList of CreativeElement's, which are the objects that represent the advertisement.The Creative Element stores a collection of AdsAttribute's (type-value pairs) with the information of the advertisement, and Interaction's, object used to invoke events. This version of the library only includes 'click2wap' interactions).</p>
<div class="fragment"><pre class="fragment"><span class="comment">// First gets the Creative Elements that are part of the ad</span>
ArrayList&lt;CreativeElement&gt; creativeElement = result.getAd().getResource().getCreativeElement();

<span class="comment">//-----------------------------------------------</span>
<span class="comment">// Process each creative element</span>
<span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; creativeElement.size(); i++) {
        CreativeElement ce = creativeElement.get(i);

        <span class="comment">//For each creative element, get the type of element in order to know if it is an image, a text or any other expected element</span>
        CreativeElement.Type type = ce.getType();

        <span class="keywordflow">switch</span> (type) {
        <span class="keywordflow">case</span> IMAGE:
                <span class="comment">//Process attributes</span>
                ArrayList&lt;AdsAttribute&gt; imageAttrs = ce.getAdsAttribute();
                        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; imageAttrs.size(); j++) {

                            <span class="comment">// Do stuff...</span>
                        }
        <span class="keywordflow">break</span>;

        <span class="keywordflow">case</span> TEXT:
                <span class="comment">//Process attributes</span>
                ArrayList&lt;AdsAttribute&gt; textAttrs = ce.getAdsAttribute();
                        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; textAttrs.size(); j++) {

                            <span class="comment">// Do stuff...</span>
                        }
        <span class="keywordflow">break</span>;
        }

        <span class="comment">//Process interactions...</span>
        ArrayList&lt;Interaction&gt; imageInteractions = ce.getInteraction();
        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; imageInteractions.size(); j++) {

            <span class="comment">// Do stuff...</span>
        }
}
</pre></div><h4><a class="anchor" id="getmediacontent_function_sec"></a>
Retrieving a simple advertisement: the getMediaContent function</h4>
<p>The simpleAd function does not retrieve -download- the image banner from the advertisement location. This API provides an useful function to do this. The getMediaContent retrieves the resource identified by the uri content -typically an image- in a simple manner.</p>
<p>Take a look at the getMediaContent signature:</p>
<div class="fragment"><pre class="fragment">InputStream getMediaContent(String uri) <span class="keywordflow">throws</span> BlueviaClientException
</pre></div><p>Just pass a simple parameter indicating the URI locator which determines the location of that content.</p>
<h3><a class="anchor" id="advertising_code_example_sec"></a>
Bluevia Advertising API: Code example</h3>
<div class="fragment"><pre class="fragment"><span class="comment">//-----------------------------------------------</span>
<span class="comment">// Get a simple Ad using the Ad API</span>
<span class="comment">// 1. Create the client (you have to choose the mode and include the authorization values)</span>
Token accessToken = <span class="keyword">new</span> Token(<span class="stringliteral">&quot;oauth_token&quot;</span>, <span class="stringliteral">&quot;oauth_token_secret&quot;</span>);
        
BlueviaAdClient adClient = <span class="keyword">new</span> BlueviaAdClient(getApplicationContext(), Mode.LIVE,
        <span class="stringliteral">&quot;consumer_key&quot;</span>, <span class="stringliteral">&quot;consumer_secret&quot;</span>, accessToken); 

<span class="comment">// 2. Request a simple advertisement. We need at least the mandatory parameters: adSpace (12921) and ProtectionPolicyType (SAFE).</span>
<span class="keywordflow">try</span> {
    AdResponse response = adClient.simpleAd(<span class="stringliteral">&quot;12921&quot;</span>, null, null, null,  null, ProtectionPolicyType.SAFE);

        <span class="comment">// 3. Process the request</span>
        <span class="comment">// First gets the Creative Elements that are part of the ad</span>
        ArrayList&lt;CreativeElement&gt; creativeElement = result.getAd().getResource().getCreativeElement();

        <span class="comment">//-----------------------------------------------</span>
        <span class="comment">// Process each creative element</span>
        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; creativeElement.size(); i++) {
                CreativeElement ce = creativeElement.get(i);

                <span class="comment">//For each creative element, get the type of element in order to know if it is an image, </span>
                <span class="comment">//a text or any other expected element</span>
                CreativeElement.Type type = ce.getType();

                <span class="comment">//-----------------------------------------------</span>
                <span class="keywordflow">switch</span> (type) {
                <span class="keywordflow">case</span> IMAGE:
                        mImageInteractionUrl = null;
                        <span class="comment">//Get the attributes of the image creative element in order to find the image location</span>
                        ArrayList&lt;AdsAttribute&gt; imageAttrs = ce.getAdsAttribute();
                        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; imageAttrs.size(); j++) {
                                AdsAttribute imageAttr = imageAttrs.get(j);
                                AdsAttribute.Type imageAttrType = imageAttr.getType();
                                <span class="keywordflow">if</span> ((imageAttrType == AdsAttribute.Type.LOCATOR) || (imageAttrType == AdsAttribute.Type.URL)) {

                                        <span class="comment">//-----------------------------------------------</span>
                                        <span class="comment">//Gets the media content using the BlueviaAdClient and the retrieve url location</span>
                                        InputStream is = adClient.getMediaContent(imageAttr.getValue());

                                        <span class="comment">//Sets the image input stream into an Android ImageView (mAdSpace)</span>

                                        mAdSpace.setImageBitmap(BitmapFactory.decodeStream(is));
                                        mAdSpace.setVisibility(View.VISIBLE);
                                        <span class="comment">//There should be only just one attribute for the location of the image</span>
                                        <span class="keywordflow">break</span>;
                                }       
                        }

                        <span class="comment">//Get the available interactions for the image</span>
                        ArrayList&lt;Interaction&gt; imageInteractions = ce.getInteraction();
                                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; imageInteractions.size(); j++) {
                                <span class="comment">//Process each interaction</span>
                                Interaction imageInteraction = imageInteractions.get(j);
                                        <span class="comment">//Currently there is only one type of interaction_ Click2Wap</span>
                                        <span class="keywordflow">if</span> (imageInteraction.getType() == Interaction.Type.CLICK_2_WAP) {
                                                <span class="comment">// Get the attributes of the interaction in order to know the url of the interaction</span>
                                                ArrayList&lt;AdsAttribute&gt; imageInteractionAttrs = imageInteraction.getAttribute();
                                                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; imageInteractionAttrs.size(); k++) {
                                                AdsAttribute imageInteractionAttr = imageInteractionAttrs.get(k);
                                                <span class="keywordflow">if</span> (imageInteractionAttr.getType() == AdsAttribute.Type.URL) {
                                                <span class="comment">// Get the interaction click2wap url value</span>
                                                mImageInteractionUrl = imageInteractionAttr.getValue();

                                                <span class="comment">// Ad a click event to the Android graphic component mAdSpace, so when the user</span>
                                                <span class="comment">//clicks on the image, the app launches the browser using the interaction url</span>
                                                mAdSpace.setOnClickListener(<span class="keyword">new</span> OnClickListener() {
                                                        <span class="keyword">public</span> <span class="keywordtype">void</span> onClick(View v) {
                                                                Intent i = <span class="keyword">new</span> Intent(Intent.ACTION_VIEW);
                                                                <span class="keywordflow">if</span> (mImageInteractionUrl != null) {
                                                                        i.setData(Uri.parse(mImageInteractionUrl));
                                                                        startActivity(i);
                                                                }
                                                        }
                                                });
                                                <span class="keywordflow">break</span>;
                                                }
                                        }
                                }
                        }
                <span class="keywordflow">break</span>;
                <span class="comment">//-----------------------------------------------</span>
                <span class="keywordflow">case</span> TEXT:
                        mTextInteractionUrl = null;
                        <span class="comment">//Gets the attributes for the text creative element in order to know the ad text</span>
                        ArrayList&lt;AdsAttribute&gt; textAttrs = ce.getAdsAttribute();
                        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; textAttrs.size(); j++) {
                                AdsAttribute textAttr = textAttrs.get(j);
                                String text = null;
                                <span class="keywordflow">if</span> (textAttr.getType() == AdsAttribute.Type.ADTEXT) {
                                        <span class="comment">// Get the text value of the add, and show that value using an Android TextView graphic element</span>
                                        mText.setText(textAttr.getValue());
                                }
                        }
                        <span class="comment">//Get the available interactions for the text</span>
                        ArrayList&lt;Interaction&gt; textInteractions = ce.getInteraction();
                        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; textInteractions.size(); j++) {
                                Interaction textInteraction = textInteractions.get(j);
                                <span class="comment">//Currently there is only one type of interaction:Click2Wap</span>
                                <span class="keywordflow">if</span> (textInteraction.getType() == Interaction.Type.CLICK_2_WAP) {
                                        ArrayList&lt;AdsAttribute&gt; textInteractionAttrs = textInteraction.getAttribute();
                                        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; textInteractionAttrs.size(); k++) {
                                                AdsAttribute textInteractionAttr = textInteractionAttrs.get(k);
                                                <span class="keywordflow">if</span> (textInteractionAttr.getType() == AdsAttribute.Type.URL) {
                                                        mTextInteractionUrl = textInteractionAttr.getValue();

                                                <span class="comment">// Ad a click event to the Android graphic component mText, so when the user</span>
                                                <span class="comment">//clicks on the text, the app launches the browser using the interaction url</span>
                                                mText.setOnClickListener(<span class="keyword">new</span> OnClickListener() {
                                                        <span class="keyword">public</span> <span class="keywordtype">void</span> onClick(View v) {
                                                                Intent i = <span class="keyword">new</span> Intent(Intent.ACTION_VIEW);
                                                                <span class="keywordflow">if</span> (mTextInteractionUrl != null) {
                                                                        i.setData(Uri.parse(mTextInteractionUrl));
                                                                        startActivity(i);
                                                                }
                                                        }
                                                });
                                                <span class="keywordflow">break</span>;
                                        }
                                }
                        }
                }
                <span class="keywordflow">break</span>;
                <span class="comment">//-----------------------------------------------</span>
                <span class="keywordflow">default</span>:
                        Log.d (TAG,<span class="stringliteral">&quot;Creative Element Type not supported in the app&quot;</span>);
                        <span class="keywordflow">return</span>;
                }
        }
} <span class="keywordflow">catch</span> (BlueviaClientException e) {
        Log.e (TAG, <span class="stringliteral">&quot;Error getting advertisement&quot;</span>, e);
}

<span class="comment">//-----------------------------------------------</span>
<span class="comment">// 4. Finally close the client</span>
adClient.close();
</pre></div> </div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="footer">Generated on Thu Jan 26 2012 11:10:33 for BlueViaAndroidSDK by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3 </li>
    </ul>
  </div>

</body>
</html>
