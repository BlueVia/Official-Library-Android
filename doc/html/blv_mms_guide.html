<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>BlueViaAndroidSDK: MMS API guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.3 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">BlueViaAndroidSDK&#160;<span id="projectnumber">1.4</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('blv_mms_guide.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<h1>MMS API guide </h1>  </div>
</div>
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="mms_abstract_sec"></a>
Abstract</h2>
<p>The Bluevia MMS API is a set of functions which allows users to send and receive MMS messages and to request the status of those previously sent MMS messages. This guide represents a practical introduction to developing applications in which the user wants to provide the Bluevia MMS functionality.</p>
<h2><a class="anchor" id="blv_mms_api_sending_mms_messages_sec"></a>
Bluevia MMS API: Sending MMS messages</h2>
<p>The Bluevia MMS API is a set of functions which allows users to send and receive MMS messages and to request the status of those previously sent. This guide represents a practical introduction to developing applications in which the user wants to provide the Bluevia MMS functionality.</p>
<h3><a class="anchor" id="mms_client_basics_sec"></a>
MMS Client Basics</h3>
<p>A MMS client represents the client side in a classic client-server schema. This object wraps up the underlying REST client side functionality needed to perform requests against a REST server. Moreover the MMS client provides a set of mock working modes useful to test its functionality even without connectivity or a real server.</p>
<p>Any Bluevia client performs requests and receives responses in a secure mode. Clients are authorized following the OAuth protocol. This security protocol enables users to grant third-party access to their resources without sharing their passwords. So clients store the authorization data -called security credentials- to get access to the server. Following sections describe what security credentials we are talking about.</p>
<h3><a class="anchor" id="creating_a_mms_client_sec"></a>
Creating a MMS Client</h3>
<p>The first step in using the MMS client is to create a MmsClient object. As we mentioned earlier this object could have two different working modes: i) as a client which sends requests to a real server, or ii) as a client which sends request and receives responses to/from a mock server. If the user wants to test or to run his application by using a mock client he also can decide how the server will work.</p>
<h4><a class="anchor" id="mmsclient_features_working_modes_sec"></a>
MmsClient features: working modes</h4>
<p>When you create the client, you can specify various working modes: </p>
<ul>
<li>
<p class="startli">AbstractRestClient.Mode.LIVE <br/>
In the Live environment your application uses the real network, which means that you will be able to send real transactions to real Movistar, O2 and Vivo customers in the applicable country.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">AbstractRestClient.Mode.TEST <br/>
The Test mode behave exactly like the Live mode, but the API calls are free of chargue, using a credits system. You are required to have a Movistar, O2 or Vivo mobile number to get this monthly credits.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">AbstractRestClient.Mode.SANDBOX <br/>
The Sandbox environment offers you the exact same experience as the Live environment except that no traffic is generated on the live network, meaning you can experiment and play until your heartâ€™s content.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">AbstractRestClient.Mode.MOCK_OK <br/>
The client works against a mock Bluevia server which always serves properly any request.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">AbstractRestClient.Mode.MOCK_UNAUTHORIZED <br/>
The client works against a mock Bluevia server which always responds with an BlueviaClientException informing the user is not authorized to perform that request.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">AbstractRestClient.Mode.MOCK_ERROR_IOEXCEPTION <br/>
The client works against a mock Bluevia server which always responds with an BlueviaClientException informing the user is unable to connect the server due to an in/out exception.</p>
<p class="endli"></p>
</li>
<li>
AbstractRestClient.Mode.MOCK_ERROR_HTTPEXCEPTION <br/>
The client works against a mock Bluevia server which always responds with a BlueviaClientException informing the user is unable to connect the server due a http exception. </li>
</ul>
<h4><a class="anchor" id="mmsclient_features_security_credentials"></a>
MmsClient features: security credentials</h4>
<p>BlueVia uses OAuth as its authentication mechanism which enables websites and applications to access the BlueVia API's without end users disclosing their personal credentials. In order to grant access to the server any client has to be created passing the security credential as parameter in its constructor. These security credentials are managed internally and added as a HTTP header in every request sent to the server. Such Oauth security credentials are: </p>
<ul>
<li>
<p class="startli"><b>Consumer key</b> <br/>
The string identifying the application- you obtained when you registered your application within the provisioning portal.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><b>Consumer Secret</b> <br/>
A secret -a string- used by the consumer to establish ownership of the consumer key.</p>
<p class="endli"></p>
</li>
<li>
<b>Access token</b> <br/>
The token -OAuth access token- used by the client for granting access permissions to the server </li>
</ul>
<h4><a class="anchor" id="mmsclient_features_recipients_addresses"></a>
MmsClient features: recipients</h4>
<p>A key issue on this client is how to specify the recipients addresses for every MMS message. Recipients addresses use the object called UserId. This class represent the user identification. It may be used to identify the user on requests.</p>
<p>How to specify recipients: </p>
<ul>
<li>
<p class="startli">Recipient: The recipient of the MMS may be identified by a phone number. The user must indicate a phone number as 'userIdValue' value which is a maximum of 15 digits following the E164 format and a UserId.PHONE_NUMBER value for the 'type' parameter.</p>
<div class="fragment"><pre class="fragment"> UserId userId(UserId.PHONE_NUMBER, <span class="stringliteral">&quot;0034913374214&quot;</span>);
</pre></div> </li>
</ul>
<h4><a class="anchor" id="mmsclient_features_freeing_resources_sec"></a>
MMSClient features: freeing resources</h4>
<p>It is very important to free the resources that the client instantiates to work. To do this call the close method after finishing using the client:</p>
<div class="fragment"><pre class="fragment">mmsClient.close();
</pre></div><h4><a class="anchor" id="mmsclient_features_code_examples_sec"></a>
MmsClient features: code example</h4>
<p>Find below an example about how to create a MmsClient object taking into account all information previously given. This snippet shows how to access a Bluevia server using OAuth security credentials</p>
<div class="fragment"><pre class="fragment"><span class="comment">// The token - OAuth access token.</span>
Token accessToken = <span class="keyword">new</span> Token(<span class="stringliteral">&quot;oauth_token&quot;</span>, <span class="stringliteral">&quot;oauth_token_secret&quot;</span>);

<span class="comment">// AbstractRestClient.Mode.LIVE indicating the client works against a real Bluevia server.</span>
<span class="keywordflow">try</span> {
        BlueviaMmsMTClient mmsClient = <span class="keyword">new</span> BlueviaMmsMTClient(getApplicationContext(), Mode.LIVE, <span class="stringliteral">&quot;consumer_key&quot;</span>, <span class="stringliteral">&quot;consumer_secret&quot;</span>, accessToken);
} <span class="keywordflow">catch</span> (BlueviaClientException e){
        Log.e(TAG, e.getMessage());
}
</pre></div><h3><a class="anchor" id="creating_mms_messages_sec"></a>
Creating MMS messages</h3>
<p>User creates new MMS messages by using the MmsMessage class. This class represents a MMS message object which an user send to one or several recipients.</p>
<h4><a class="anchor" id="mms_message_features_sec"></a>
MMS message features</h4>
<p>These are the features provided by the MmsMessage object:</p>
<ul>
<li>
Different approaches on how to create a MmsMessage. For example a user creates an MmsMessage object by specifying a message subject and a single recipient and a source identification from this MmsMessage is sent and an attachment. See the <a class="el" href="api_reference.html">API Reference</a> for a more detailed description. </li>
<li>
Once the user creates an MmsMessage it is possible to add new attachments. </li>
<li>
Once the user creates an MmsMessage it is possible to add new recipients. </li>
<li>
Recipients and source and all public members could be retrieved by using the corresponding access functions. </li>
</ul>
<h4><a class="anchor" id="mms_message_features_adding_attachments_sec"></a>
Adding attachments to the MMS message</h4>
<p>Several attachments could be attached to the MMS message. The class that represent multipart attachment is FilePart, which extends the abstract BlueviaPartBase class. There are two options to instantiate it:</p>
<ul>
<li>
<div class="fragment"><pre class="fragment"> FilePart(String name, File file, String contentType) <span class="keywordflow">throws</span> FileNotFoundException 
</pre></div> <p class="endli"></p>
</li>
<li>
<div class="fragment"><pre class="fragment"> FilePart(String name, PartSource partSource, String contentType) <span class="keywordflow">throws</span> FileNotFoundException 
</pre></div>  </li>
</ul>
<p>Developers can attach element in two ways: i) by using the function sendMms, or ii) by using specific member functions of the MmsMessage object.</p>
<p>Take a look at these different ways: </p>
<ul>
<li>
<p class="startli">sendMms function: </p>
<div class="fragment"><pre class="fragment"> String sendMms(String subject, UserId address, BlueviaPartBase[] parts) <span class="keywordflow">throws</span> BlueviaClientException 
</pre></div><p>This function allows a user to specify an array of elements the user wants to attach to the MMS message. Each item from that list of elements contains an instance of BlueviaPartBase class. Examples of elements to attach could be images, videos, sounds, text files, etc. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Specific member functions of the MmsMessage object:</p>
<ul>
<li>
<p class="startli">Add an attachment list by using the MmsMessage constructor.</p>
<div class="fragment"><pre class="fragment"> MmsMessage(String subject, UserId address, ArrayList&lt;BlueviaPartBase&gt; mAttachmetList)
</pre></div><div class="fragment"><pre class="fragment"> MmsMessage(String subject, ArrayList&lt;UserId&gt; addressList, ArrayList&lt;BlueviaPartBase&gt; attachmentList)
</pre></div><p class="endli"></p>
</li>
<li>
<p class="startli">Add one attachment by using the addAttachment method:</p>
<div class="fragment"><pre class="fragment"> <span class="keywordtype">void</span> addAttachment(BlueviaPartBase attachment)
</pre></div> </li>
</ul>
</li>
</ul>
<h4><a class="anchor" id="mms_message_features_content"></a>
MMS message features: available content types</h4>
<p>The following list contains the available content-types in Bluevia:</p>
<ul>
<li>
text/plain </li>
<li>
image/jpeg </li>
<li>
image/bmp </li>
<li>
image/gif </li>
<li>
image/png </li>
<li>
audio/amr </li>
<li>
audio/midi </li>
<li>
audio/mp3 </li>
<li>
audio/mpeg </li>
<li>
audio/wav </li>
<li>
video/mp4 </li>
<li>
video/avi </li>
<li>
video/3gpp </li>
</ul>
<h4><a class="anchor" id="mms_message_features_code_example_sec"></a>
MMS message features: code examples</h4>
<p>Find below an example about how to create a MmsMessage object taking into account all information previously given.</p>
<div class="fragment"><pre class="fragment"><span class="comment">// Build the message</span>
MmsMessage mms = <span class="keyword">new</span> MmsMessage();
mms.setSubject(<span class="stringliteral">&quot;Mms Subject&quot;</span>);
mms.addAddress(<span class="keyword">new</span> UserId(Type.PHONE_NUMBER,<span class="stringliteral">&quot;600010101&quot;</span>));

<span class="comment">// The attachment is a file located at the sdcard</span>
<span class="comment">// To create the FilePart we need the name of the file, the file descriptor and the file content-type</span>
File f= <span class="keyword">new</span> File(<span class="stringliteral">&quot;/sdcard/image.gif&quot;</span>);
mms.addAttachment(<span class="keyword">new</span> FilePart(<span class="stringliteral">&quot;image.gif&quot;</span>, f, BlueviaPartBase.IMAGE_GIF));
</pre></div><h3><a class="anchor" id="sending_mms_messages_sec"></a>
Sending MMS messages</h3>
<p>The MmsClient object has two different ways for sending MMS messages. The first one allows an user to send a MMS object without specifically creating an MmsMessage object so the user has to pass all parameters needed. On the other hand the second approach allows a user to send directly a previously created MmsMessage.</p>
<p>Take a look at these three functions:</p>
<ul>
<li>
<div class="fragment"><pre class="fragment"> String sendMms(String subject, UserId address, BlueviaPartBase[] parts) <span class="keywordflow">throws</span> BlueviaClientException 
</pre></div><p>It sends a MMS message to one recipient without specifically creating a MmsMessage object. </p>
<p class="endli"></p>
</li>
<li>
<div class="fragment"><pre class="fragment"> String sendMms(String subject, UserId[] addresses, BlueviaPartBase[] parts) <span class="keywordflow">throws</span> BlueviaClientException 
</pre></div><p>It sends a MMS message to any number of recipients without specifically creating a MmsMessage object. </p>
<p class="endli"></p>
</li>
<li>
<div class="fragment"><pre class="fragment"> String sendMms(MmsMessage mmsMessage) <span class="keywordflow">throws</span> BlueviaClientException 
</pre></div><p>It sends directly a MmsMessage previously created.</p>
<p class="endli">This function returns the MMS Id which indentifies that sending operation. This identification is useful to retrieve the delivery status of that MMS message.  </p>
</li>
</ul>
<p>All functions return the MMS Id which indentifies that sending operation. This identification is useful to retrieve the delivery status of that MMS message.</p>
<p>For a more detailed description see the <a class="el" href="api_reference.html">API Reference</a>.</p>
<h3><a class="anchor" id="requesting_status_sec"></a>
Requesting the status of a previously sent MMS messages</h3>
<p>Once the MMS message is sent successfully the user may want to know the delivery status of that MMS message. The MmsClient allows a user to determine if the MMS message reaches the destination or not. For this matter we use the getMmsDeliveryStatus function. Just pass the MMS Id -returned by the sendMms function- and retrieve the delivery status of that message, that easy!.</p>
<p>Take a look at this function:</p>
<div class="fragment"><pre class="fragment"> ArrayList&lt;MessageDeliveryStatus&gt; getMmsDeliveryStatus(String mmsId) <span class="keywordflow">throws</span> BlueviaClientException  
</pre></div><p>It obtains the delivery status of a previously sent MMS message.</p>
<p>Possible delivery statuses are: </p>
<ul>
<li>
DeliveryToNetwork </li>
<li>
DeliveryUncertain </li>
<li>
DeliveryImpossible </li>
<li>
MessageWaiting </li>
<li>
DeliveryToTerminal </li>
<li>
DeliveryNotificationNotSupported </li>
</ul>
<p>For a more detailed description see the <a class="el" href="api_reference.html">API Reference</a>.</p>
<h3><a class="anchor" id="receiving_MMS_messages"></a>
Receiving MMS messages</h3>
<p>This client uses OAuth-2-legged process so access token is not mandatory and applications that does not need user's permissions.</p>
<div class="fragment"><pre class="fragment"><span class="comment">// AbstractRestClient.Mode.LIVE indicating the client works against a real Bluevia server.</span>
<span class="keywordflow">try</span> {
        BlueviaMmsMOClient mmsClient = <span class="keyword">new</span> BlueviaMmsMOClient(getApplicationContext(), AbstractRestClient.Mode.LIVE, <span class="stringliteral">&quot;consumer_key&quot;</span>, <span class="stringliteral">&quot;consumer_secret&quot;</span>);
} <span class="keywordflow">catch</span> (BlueviaClientException e){
        Log.e(TAG, e.getMessage());
}
</pre></div><p>Your application can receive MMS from users sent to BlueVia shortcodes including your application keyword. You have to take into account that you will need to remember the MMS keyword you defined when you requested you API key. The operation to get received messages has to be done in two steps. First you have to use the getMessages function to retreive the messages info, including the short number. Depending on the value of the useAttachmentIds parameter, the second step would be done in two different ways. If the parameter is true, the ids of the attachments will be retreived in order to use the getAttachment operation; otherwise the attachments would have to be obtained throught the getMessage function. The function signature is:</p>
<div class="fragment"><pre class="fragment"> ArrayList&lt;ReceivedMmsInfo&gt; getMessages(String registrationId, <span class="keywordtype">boolean</span> useAttachmentIds) <span class="keywordflow">throws</span> BlueviaClientException 
</pre></div><p>The ReceivedMmsInfo object contains the information of the sent MMS, but the attachments. In order to retreive attached documents in the MMS you have to use the following function. The messageIdentifier can be obtained in the ReceivedMmsInfo object returned by the previous function. The resultant ReceivedMms object contains the info of the Mms and a list of MimeContent objects representing the attachments.:</p>
<div class="fragment"><pre class="fragment"> ReceivedMms getMessage(String registrationId, String messageIdentifier) <span class="keywordflow">throws</span> BlueviaClientException 
</pre></div><p>Using the getAttachment function you will receive the MimeContent object corresponding to he attachment identifier:</p>
<div class="fragment"><pre class="fragment"> MimeContent getAttachment(String registrationId, String messageId, String attachmentId) <span class="keywordflow">throws</span> BlueviaClientException 
</pre></div><p>For a more detailed description see the <a class="el" href="api_reference.html">API Reference</a>.</p>
<h3><a class="anchor" id="mms_api_code_example_sec"></a>
Bluevia MMS API: code example</h3>
<div class="fragment"><pre class="fragment"><span class="comment">//-----------------------------------------------</span>
<span class="comment">// Send an MMS</span>
<span class="comment">// 1. Create the client (you have to choose the mode and include the OAuth authorization values)</span>
Token accessToken = <span class="keyword">new</span> Token(<span class="stringliteral">&quot;oauth_token&quot;</span>, <span class="stringliteral">&quot;oauth_token_secret&quot;</span>);
        
BlueviaMmsMTClient mmsClient = <span class="keyword">new</span> BlueviaMmsMTClient(getApplicationContext(), Mode.LIVE, <span class="stringliteral">&quot;consumer_key&quot;</span>, <span class="stringliteral">&quot;consumer_secret&quot;</span>, accessToken); 

<span class="comment">// 2. Build the message</span>
<span class="comment">// The addresses are UserId Objects</span>
<span class="comment">// To include a File attachment use the FilePart class.</span>
<span class="comment">// If the attachment where a String, then you should use the StringPart class.</span>
MmsMessage mms = <span class="keyword">new</span> MmsMessage();
mms.setSubject(<span class="stringliteral">&quot;Mms Subject&quot;</span>);
mms.addAddress(<span class="keyword">new</span> UserId(Type.PHONE_NUMBER,<span class="stringliteral">&quot;600010101&quot;</span>));

<span class="comment">// The attachment is a file located at the sdcard</span>
<span class="comment">// To create the FilePart we need the name of the file, the file descriptor and the file content-type</span>
File f= <span class="keyword">new</span> File(<span class="stringliteral">&quot;/sdcard/image.gif&quot;</span>);
mms.addAttachment(<span class="keyword">new</span> FilePartBase(<span class="stringliteral">&quot;image.gif&quot;</span>, f, BlueviaPartBase.IMAGE_GIF));

<span class="comment">// 3. Send the message.</span>
String result = null;
<span class="keywordflow">try</span> {
        result = mmsClient.sendMms(mms);
        <span class="comment">//-----------------------------------------------</span>

        <span class="comment">//-----------------------------------------------</span>
        <span class="comment">// Retrieve the delivery status of the sent MMS.</span>
        ArrayList&lt;MessageDeliveryStatus&gt; statusObj = mmsClient.getMmsDeliveryStatus(result);
        <span class="keywordflow">for</span> (MessageDeliveryStatus singleStatus : statusObj) {
                MessageDeliveryStatus.Status status = singleStatus.getStatus();

                <span class="keywordflow">switch</span> (status) {
                <span class="keywordflow">case</span> DELIVERED_TO_TERMINAL:
                        Log.i (TAG, <span class="stringliteral">&quot;Delivered to terminal&quot;</span>);
                        <span class="keywordflow">break</span>;
                <span class="keywordflow">case</span> DELIVERED_TO_NETWORK:
                        Log.i (TAG, <span class="stringliteral">&quot;Delivered to network&quot;</span>);
                        <span class="keywordflow">break</span>;
                <span class="keywordflow">case</span> DELIVERY_IMPOSSIBLE:
                        Log.i (TAG, <span class="stringliteral">&quot;Delivery impossible&quot;</span>);
                        <span class="keywordflow">break</span>;
                <span class="keywordflow">case</span> DELIVERY_NOTIFICATION_NOT_SUPPORTED:
                        Log.i (TAG, <span class="stringliteral">&quot;Delivery notification not supported&quot;</span>);
                        <span class="keywordflow">break</span>;
                <span class="keywordflow">case</span> DELIVERY_UNCERTAIN:
                        Log.i (TAG, <span class="stringliteral">&quot;Delivery uncertain&quot;</span>);
                        <span class="keywordflow">break</span>;
                <span class="keywordflow">case</span> MESSAGE_WAITING:
                        Log.i (TAG, <span class="stringliteral">&quot;Message waiting&quot;</span>);
                        <span class="keywordflow">break</span>;
                }
        }
        <span class="comment">//-----------------------------------------------</span>

} <span class="keywordflow">catch</span> (BlueviaClientException e) {
        Log.e (TAG, <span class="stringliteral">&quot;Error sending MMS&quot;</span>, e);
}

<span class="comment">//-----------------------------------------------</span>
<span class="comment">// Receiving MMSs:</span>
<span class="comment">// 4. Retrieve sent MMSs:</span>

BlueviaMmsMOClient mmsMoClient = <span class="keyword">new</span> BlueviaMmsMOClient(getApplicationContext(), AbstractRestClient.Mode.LIVE, <span class="stringliteral">&quot;consumer_key&quot;</span>, <span class="stringliteral">&quot;consumer_secret&quot;</span>);

String registrationId = <span class="stringliteral">&quot;553456&quot;</span>
ArrayList&lt;ReceivedMmsInfo&gt; list = mmsMoClient.getMessages(registrationId); 

<span class="keywordflow">for</span> (ReceivedMmsInfo info : list){
        ReceivedMms message = mmsClient.getMessage(registrationId, info.getMessageIdentifier());
        
        <span class="keywordflow">for</span> (MimeContent attachment : message.getAttachments()){
                <span class="comment">//Do stuff</span>
        }
        
}

<span class="comment">//-----------------------------------------------</span>
<span class="comment">// Finally close clients</span>
mmsClient.close();
mmsMoClient.close();
</pre></div> </div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="footer">Generated on Thu Jan 26 2012 11:10:32 for BlueViaAndroidSDK by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3 </li>
    </ul>
  </div>

</body>
</html>
